<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EDIFIQ — Diagnóstico</title>
  <meta name="description" content="Diagnóstico: entendemos seu negócio e mapeamos oportunidades de automação, integrações e produtos web." />
  <link rel="icon" type="image/png" href="./edifiq.png" />
  <link rel="icon" type="image/jpeg" href="./edifiq.jpg" />
  <link rel="apple-touch-icon" href="./edifiq.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --red:200,16,46; --green:0,122,61; }
    .bar-split{background:linear-gradient(to right, rgb(var(--red)) 0 50%, rgb(var(--green)) 50% 100%)}
    .soft-shadow{box-shadow:0 12px 30px rgba(0,0,0,.08)}
    .step.is-active{border-color:rgb(var(--green)); background:#f0fdf4}
  </style>
</head>
<body class="antialiased text-slate-900 bg-white">
  <!-- NAV mínima -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-slate-200">
    <nav class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="./index.html" class="flex items-center gap-3">
        <img src="./edifiq.jpg" alt="EDIFIQ" class="h-9 w-auto rounded"/>
      </a>
      <a href="./index.html#contato" class="hidden md:inline-flex items-center gap-2 rounded-xl bg-black text-white px-4 py-2 soft-shadow hover:bg-red-700 transition">
        Voltar ao site
      </a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="relative">
    <div class="w-full h-2 bar-split"></div>
    <div class="max-w-6xl mx-auto px-4 py-10 md:py-14 grid lg:grid-cols-2 gap-10 items-start">
      <div>
        <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight leading-tight">
          Diagnóstico
        </h1>
        <p class="mt-4 text-slate-600 text-lg">
          Entendemos seu cenário atual, objetivos e desafios. Com base nisso, entregamos um plano com ações priorizadas de automações, integrações e produtos web.
        </p>
        <ul class="mt-6 space-y-2 text-slate-700">
          <li>• Leva 5 minutos</li>
          <li>• Sem compromisso</li>
          <li>• Retornamos com oportunidades e próximos passos</li>
        </ul>
      </div>

      <!-- Formulário -->
      <form id="diagForm" class="space-y-4" novalidate>
        <!-- progresso -->
        <div class="grid grid-cols-4 gap-3">
          <div id="p1" class="step rounded-xl border border-slate-200 p-3 text-center text-sm">Empresa</div>
          <div id="p2" class="step rounded-xl border border-slate-200 p-3 text-center text-sm">Objetivos</div>
          <div id="p3" class="step rounded-xl border border-slate-200 p-3 text-center text-sm">Canais & Desafios</div>
          <div id="p4" class="step rounded-xl border border-slate-200 p-3 text-center text-sm">Envio</div>
        </div>

        <!-- CARD -->
        <div class="rounded-2xl border border-slate-200 bg-white soft-shadow p-6">
          <!-- step 1 -->
          <div data-step="1" class="step-pane">
            <h2 class="font-bold text-lg">1) Sobre a empresa</h2>
            <div class="mt-4 grid md:grid-cols-2 gap-4">
              <input name="empresa" required placeholder="Nome da empresa" class="px-4 py-3 rounded-xl border border-slate-300">
              <input name="site" required placeholder="Site" class="px-4 py-3 rounded-xl border border-slate-300">
              <select name="tamanho" required class="px-4 py-3 rounded-xl border border-slate-300">
                <option value="" disabled selected>Tamanho do time</option>
                <option>1-5</option><option>6-20</option><option>21-50</option><option>51-200</option><option>200+</option>
              </select>
              <select name="segmento" required class="px-4 py-3 rounded-xl border border-slate-300">
                <option value="" disabled selected>Segmento</option>
                <option>Serviços</option><option>Varejo</option><option>Indústria</option><option>Educação</option><option>Saúde</option><option>Outro</option>
              </select>
            </div>
          </div>

          <!-- step 2 -->
          <div data-step="2" class="step-pane hidden">
            <h2 class="font-bold text-lg">2) Objetivos</h2>
            <div class="mt-4 grid gap-4">
              <textarea name="objetivos" required rows="3" placeholder="Quais resultados você busca? (ex.: mais leads, reduzir custos, melhorar atendimento)" class="px-4 py-3 rounded-xl border border-slate-300"></textarea>
              <textarea name="processos" required rows="3" placeholder="Quais processos consomem tempo hoje? (ex.: propostas, cadastro, follow-up, conciliações...)" class="px-4 py-3 rounded-xl border border-slate-300"></textarea>
              <select name="orcamento" required class="px-4 py-3 rounded-xl border border-slate-300">
                <option value="" disabled selected>Faixa de orçamento mensal</option>
                <option>Até R$ 3.000</option><option>R$ 3.000–8.000</option><option>R$ 8.000–20.000</option><option>R$ 20.000+</option>
              </select>
            </div>
          </div>

          <!-- step 3 -->
          <div data-step="3" class="step-pane hidden">
            <h2 class="font-bold text-lg">3) Canais & Desafios</h2>
            <div class="mt-4 grid gap-4">
              <input name="canais" required placeholder="Canais e ferramentas atuais (CRM, ERP, WhatsApp, Instagram, RD, Pipe, etc.)" class="px-4 py-3 rounded-xl border border-slate-300">
              <textarea name="desafios" required rows="3" placeholder="Principais gargalos (ex.: retrabalho, integrações quebradas, lentidão, falta de visibilidade)" class="px-4 py-3 rounded-xl border border-slate-300"></textarea>
            </div>
          </div>

          <!-- step 4: ENVIO -->
          <div data-step="4" class="step-pane hidden">
            <h2 class="font-bold text-lg">4) Envio</h2>
            <p class="mt-2 text-slate-600 text-sm">Revise as informações, escolha a urgência e clique em “Enviar dados”.</p>

            <!-- urgência -->
            <div class="mt-4">
              <label class="block text-sm font-medium text-slate-700 mb-1">Urgência</label>
              <select name="urgencia" required class="w-full px-4 py-3 rounded-xl border border-slate-300">
                <option value="" disabled selected>Selecione a urgência</option>
                <option>Alta</option><option>Média</option><option>Baixa</option>
              </select>
            </div>

            <!-- Resumo -->
            <div class="mt-4">
              <label class="block text-sm font-medium text-slate-700 mb-1">Resumo</label>
              <pre id="preview" class="w-full whitespace-pre-wrap rounded-xl border border-slate-300 bg-slate-50 p-4 text-sm"></pre>
            </div>
          </div>
        </div>

        <div class="flex items-center justify-between">
          <button type="button" id="btnPrev" class="px-4 py-2 rounded-xl border border-slate-300 hover:bg-slate-50">Voltar</button>
          <div class="flex gap-2">
            <button type="submit" id="btnSubmit" class="hidden px-5 py-2 rounded-xl bg-black text-white hover:bg-red-700">Enviar dados</button>
            <button type="button" id="btnNext" class="px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700">Continuar</button>
          </div>
        </div>

        <p id="ok" class="hidden text-sm text-emerald-700">Dados enviados com sucesso. Entraremos em contato em breve. ✅</p>
        <p id="erro" class="hidden text-sm text-red-700">Não foi possível enviar online agora. Salvamos localmente e baixamos um CSV com o diagnóstico.</p>
      </form>
    </div>
    <div class="w-full h-2 bar-split"></div>
  </section>

  <!-- FOOTER simples -->
  <footer class="py-10 border-t border-slate-200 bg-white">
    <div class="max-w-6xl mx-auto px-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="./edifiq.jpg" alt="EDIFIQ" class="h-8 w-auto rounded"/>
        <span class="text-sm text-slate-500">© <span id="year"></span> — EDIFIQ</span>
      </div>
      <a href="./index.html" class="text-sm text-slate-500 hover:text-emerald-700">Voltar</a>
    </div>
  </footer>

  <script>
    // ========= ANO =========
    document.getElementById('year').textContent = new Date().getFullYear();

    // ========= STEPS =========
    let step = 1;
    const total = 4;
    const panes = [...document.querySelectorAll('.step-pane')];
    const marks = [p1,p2,p3,p4];

    function render(){
      panes.forEach(p=>p.classList.add('hidden'));
      panes[step-1].classList.remove('hidden');
      marks.forEach((m,i)=>m.classList.toggle('is-active', i===step-1));
      btnPrev.disabled = step===1;

      const last = step===total;
      btnNext.classList.toggle('hidden', last);
      btnSubmit.classList.toggle('hidden', !last);
      if(last) updatePreview();
    }
    render();

    btnPrev.onclick = ()=>{ if(step>1){ step--; render(); } };
    btnNext.onclick = ()=>{
      const pane = panes[step-1];
      const invalid = pane.querySelector(':invalid');
      if(invalid){ invalid.reportValidity(); return; }
      if(step<total){ step++; render(); }
    };

    // ========= FORMAT/RESUMO =========
    function fmt(form){
      const d = Object.fromEntries(new FormData(form).entries());
      const linhas = [
        `DIAGNÓSTICO`,
        ``,
        `Empresa: ${d.empresa}`,
        `Site: ${d.site}`,
        `Tamanho: ${d.tamanho}`,
        `Segmento: ${d.segmento}`,
        ``,
        `Objetivos: ${d.objetivos}`,
        `Processos críticos: ${d.processos}`,
        `Orçamento: ${d.orcamento}`,
        ``,
        `Canais: ${d.canais}`,
        `Desafios: ${d.desafios}`,
        ``,
        `Urgência: ${d.urgencia || '(não informada)'}`
      ];
      return linhas.join('\n');
    }

    function collect(form){
      const d = Object.fromEntries(new FormData(form).entries());
      return {
        empresa:  d.empresa || '',
        site:     d.site || '',
        tamanho:  d.tamanho || '',
        segmento: d.segmento || '',
        objetivos: d.objetivos || '',
        processos: d.processos || '',
        orcamento: d.orcamento || '',
        canais:    d.canais || '',
        desafios:  d.desafios || '',
        urgencia:  d.urgencia || '',
        origem:   'diagnostico',
        resumo:   fmt(form)
      };
    }

    function updatePreview(){
      const prev = document.getElementById('preview');
      if(prev) prev.textContent = fmt(diagForm);
    }

    diagForm.addEventListener('input', ()=>{ if(step===total) updatePreview(); });

    // ========= FORMSPREE + FALLBACK =========
    const FORMSPREE_URL = 'https://formspree.io/f/mrbargeq';
    const KEY_LOCAL = 'edifiq_diag';

    function saveLocal(row){
      try{
        const prev = JSON.parse(localStorage.getItem(KEY_LOCAL) || '[]');
        prev.push({ ts: Date.now(), ...row });
        localStorage.setItem(KEY_LOCAL, JSON.stringify(prev));
      }catch(_){}
    }

    function downloadCSV(row){
      const headers = [
        'timestamp','empresa','site','tamanho','segmento',
        'objetivos','processos','orcamento','canais','desafios','urgencia','origem'
      ];
      const values = [
        new Date().toISOString(),
        row.empresa,row.site,row.tamanho,row.segmento,
        row.objetivos,row.processos,row.orcamento,row.canais,row.desafios,row.urgencia,row.origem
      ];
      const csv = headers.join(',') + '\n' + values.map(v => `"${String(v||'').replace(/"/g,'""')}"`).join(',');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement('a');
      a.href = url;
      a.download = 'diagnostico-edifiq.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    async function sendOnline(data){
      try{
        const fd = new FormData();
        fd.append('_subject','Novo diagnóstico');
        fd.append('_captcha','false');
        fd.append('empresa',  data.empresa);
        fd.append('site',     data.site);
        fd.append('tamanho',  data.tamanho);
        fd.append('segmento', data.segmento);
        fd.append('objetivos',data.objetivos);
        fd.append('processos',data.processos);
        fd.append('orcamento',data.orcamento);
        fd.append('canais',   data.canais);
        fd.append('desafios', data.desafios);
        fd.append('urgencia', data.urgencia);
        fd.append('origem',   data.origem);
        fd.append('resumo',   data.resumo);

        const r = await fetch(FORMSPREE_URL, { method:'POST', body: fd, headers:{ 'Accept':'application/json' } });
        return r.ok;
      }catch(_){ return false; }
    }

    // ========= SUBMIT =========
    diagForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      // garante que tudo está válido
      if(!diagForm.reportValidity()) return;

      const payload = collect(diagForm);

      // desabilita botões enquanto envia
      btnSubmit.disabled = true; btnSubmit.textContent = 'Enviando...';
      btnNext.disabled = true; btnPrev.disabled = true;
      document.getElementById('ok').classList.add('hidden');
      document.getElementById('erro').classList.add('hidden');

      const ok = await sendOnline(payload);
      if(!ok){
        saveLocal(payload);
        downloadCSV(payload);
        document.getElementById('erro').classList.remove('hidden');
      }else{
        document.getElementById('ok').classList.remove('hidden');
        // opcional: resetar formulário
        // diagForm.reset(); step=1; render();
      }

      btnSubmit.disabled = false; btnSubmit.textContent = 'Enviar dados';
      btnNext.disabled = false; btnPrev.disabled = false;
    });
  </script>
</body>
</html>
