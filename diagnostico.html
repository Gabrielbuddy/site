<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>EDIFIQ — Diagnóstico</title>
  <link rel="icon" type="image/png" href="./edifiq.png"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--red:200,16,46;--green:0,122,61;}
    .bar-split{background:linear-gradient(to right,rgb(var(--red))50%,rgb(var(--green))50%)}
    .soft-shadow{box-shadow:0 12px 30px rgba(0,0,0,.08)}
    .step.is-active{border-color:rgb(var(--green));background:#f0fdf4}
  </style>
</head>
<body class="bg-white text-slate-900">
<header class="sticky top-0 bg-white/90 border-b border-slate-200">
  <nav class="max-w-6xl mx-auto flex justify-between p-3">
    <a href="./index.html"><img src="./edifiq.jpg" class="h-9 rounded"/></a>
  </nav>
</header>

<section class="max-w-6xl mx-auto p-6">
  <form id="diagForm" class="space-y-4">
    <div class="grid grid-cols-4 gap-2">
      <div id="p1" class="step border p-2 rounded text-center">Empresa</div>
      <div id="p2" class="step border p-2 rounded text-center">Objetivos</div>
      <div id="p3" class="step border p-2 rounded text-center">Canais</div>
      <div id="p4" class="step border p-2 rounded text-center">Envio</div>
    </div>
    <div class="rounded-2xl border p-6 soft-shadow">
      <div data-step="1" class="step-pane">
        <input name="empresa" required placeholder="Empresa" class="border p-2 w-full mb-2 rounded"/>
        <input name="site" required placeholder="Site" class="border p-2 w-full mb-2 rounded"/>
      </div>
      <div data-step="2" class="step-pane hidden">
        <textarea name="objetivos" required placeholder="Objetivos" class="border p-2 w-full mb-2 rounded"></textarea>
      </div>
      <div data-step="3" class="step-pane hidden">
        <input name="canais" required placeholder="Canais" class="border p-2 w-full mb-2 rounded"/>
        <textarea name="desafios" required placeholder="Desafios" class="border p-2 w-full mb-2 rounded"></textarea>
      </div>
      <div data-step="4" class="step-pane hidden">
        <select name="urgencia" required class="border p-2 w-full rounded mb-2">
          <option value="">Urgência</option>
          <option>Alta</option><option>Média</option><option>Baixa</option>
        </select>
        <pre id="preview" class="bg-slate-50 p-3 text-sm rounded"></pre>
      </div>
    </div>
    <div class="flex justify-between">
      <button type="button" id="btnPrev" class="border px-3 py-1 rounded">Voltar</button>
      <div>
        <button type="button" id="btnWhats" class="hidden border px-3 py-1 rounded">WhatsApp</button>
        <button type="submit" id="btnSubmit" class="hidden bg-black text-white px-3 py-1 rounded">E-mail</button>
        <button type="button" id="btnNext" class="bg-emerald-600 text-white px-3 py-1 rounded">Continuar</button>
      </div>
    </div>
    <p id="ok" class="hidden text-emerald-700 mt-2">Enviado ✅</p>
  </form>
</section>

<script>
const WEBAPP_URL='SUA_URL_DO_WEBAPP'; // substitua
const contact=JSON.parse(localStorage.getItem('edifiq_contact')||'{}');
let step=1;const panes=[...document.querySelectorAll('.step-pane')];const marks=[p1,p2,p3,p4];
function render(){panes.forEach((p,i)=>p.classList.toggle('hidden',i!==step-1));marks.forEach((m,i)=>m.classList.toggle('is-active',i===step-1));
btnPrev.disabled=step===1;const last=step===4;btnNext.classList.toggle('hidden',last);btnSubmit.classList.toggle('hidden',!last);btnWhats.classList.toggle('hidden',!last);if(last)preview.textContent=fmt(diagForm);}
function fmt(f){const d=Object.fromEntries(new FormData(f).entries());return`DIAGNÓSTICO\nEmpresa:${d.empresa}\nSite:${d.site}\nObjetivos:${d.objetivos}\nCanais:${d.canais}\nDesafios:${d.desafios}\nUrgência:${d.urgencia}`;}
btnPrev.onclick=()=>{if(step>1){step--;render()}};btnNext.onclick=()=>{if(!diagForm.reportValidity())return;step++;render()};
btnWhats.onclick=async()=>{if(!diagForm.reportValidity())return;await salvar('whatsapp');window.open(`https://wa.me/5553999038427?text=${encodeURIComponent(fmt(diagForm))}`,'_blank');}
diagForm.onsubmit=async e=>{e.preventDefault();if(!diagForm.reportValidity())return;await salvar('email');document.getElementById('ok').classList.remove('hidden');window.location.href='mailto:edifiqcolab@gmail.com?subject=Diagnóstico&body='+encodeURIComponent(fmt(diagForm));}
async function salvar(origem){const d=Object.fromEntries(new FormData(diagForm).entries());const payload={...d,...contact,origem,sendEmail:origem==='email',assunto:'Diagnóstico EDIFIQ',corpo:fmt(diagForm),para:'edifiqcolab@gmail.com'};try{await fetch(WEBAPP_URL,{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify(payload)});}catch(e){console.warn(e)}}
render();
</script>
</body>
</html>
